<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="fragments/head :: head"/>

    <script th:src="@{/webjars/bootstrap-datepicker/js/bootstrap-datepicker.js}" type="text/javascript"></script>
    <script th:src="@{/webjars/bootstrap-datepicker/locales/bootstrap-datepicker.es.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/jquery.dataTables.min.js}" type="text/javascript"></script>
    <link th:href="@{/webjars/bootstrap-datepicker/css/bootstrap-datepicker.css}" rel="stylesheet" type="text/css" />
    <link href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <script th:src="@{/webjars/bootstrap-datepicker/js/bootstrap-datepicker.js}" type="text/javascript"></script>
    <script th:src="@{/webjars/bootstrap-datepicker/locales/bootstrap-datepicker.es.min.js}" type="text/javascript"></script>
    <link th:href="@{/webjars/bootstrap-datepicker/css/bootstrap-datepicker.css}" rel="stylesheet" type="text/css" />
</head>
<body>
    <div th:replace="fragments/navbar :: navbar"></div>

    <div class="container">

        <h3>Eventos</h3>
        <label>Fecha min</label>
        <input type="text" placeholder="Fecha min" id="fechaMin">
        <label>Fecha max</label>
        <input type="text" placeholder="Fecha max" id="fechaMax">
        <table class="table table-bordered table-striped" id="eventos">

            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Horario</th>
                    <th>Localidad</th>
                    <th>Personas</th>
                    <th>Precio</th>
                    <th>Niños</th>
                    <th>Precio niños</th>
                    <th>Confirmado</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="evento: ${eventos}">
                    <td th:text="${#dates.format(evento.fecha, 'yyyy-MM-dd')}"></td>
                    <td th:text="${evento.tipo}"></td>
                    <td th:text="${evento.horario}"></td>
                    <td th:text="${evento.localidad}"></td>
                    <td th:text="${evento.personas}"></td>
                    <td th:text="${evento.precioMenu}"></td>
                    <td th:text="${evento.ninyos}"></td>
                    <td th:text="${evento.precioMenuNinyos}"></td>
                    <td>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="customCheck1" th:checked="${evento.confirmado}">
                            <label class="custom-control-label" for="customCheck1"></label>
                        </div>
                    </td>
                </tr>
            </tbody>

        </table>
    </div>

</body>
<script type="text/javascript">
    let minDate = $('#fechaMin').datepicker({
        format: "yyyy-mm-dd",
        language: "es",
        orientation: "bottom auto",
        autoclose: true
    });

    let maxDate = $('#fechaMax').datepicker({
        format: "yyyy-mm-dd",
        language: "es",
        orientation: "bottom auto",
        autoclose: true
    });

    $.fn.dataTable.ext.search.push(
        function( settings, data, dataIndex ) {
            let min = minDate.val();
            let max = maxDate.val();

            if (minDate.val()){
                min = new Date(minDate.val());
            }
            if (maxDate.val()){
                max = new Date(maxDate.val());
            }
            let date = new Date( data[0] );

            return (min === '' && max === '') ||
                (min === '' && date <= max) ||
                (min <= date && max === '') ||
                (min <= date && date <= max);

        }
    );

    let table = $('#eventos').DataTable({
        order: [0, 'asc'],
        columnDefs: [
            { orderable: false, targets: [1, 2, 3, 8] }
        ],
        initComplete: function () {
            this.api()
                .columns([1, 2 , 3, 8])
                .every(function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo($(column.header()))
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());

                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });

                    column
                        .data()
                        .unique()
                        .sort()
                        .each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>');
                        });
                });
        }
    });

    // Refilter the table
    $('#fechaMin, #fechaMax').on('change', function () {
        table.draw();
    });

</script>
</html>